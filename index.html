<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëë –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è - –ü–æ–≤–µ–ª–∏—Ç–µ–ª—å</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–ö–æ–Ω—Ç—Ä–æ–ª—å –ü–æ–≤–µ–ª–∏—Ç–µ–ª—è">
    
    <link rel="manifest" href="data:application/json,{
        'name': '–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–ª—è –ü–æ–≤–µ–ª–∏—Ç–µ–ª—è',
        'short_name': '–ö–æ–Ω—Ç—Ä–æ–ª—å',
        'description': '–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω—å—é',
        'start_url': '/',
        'display': 'standalone',
        'background_color': '#ffffff',
        'theme_color': '#667eea',
        'icons': [{
            'src': 'data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 192 192\'><rect width=\'192\' height=\'192\' fill=\'%23667eea\'/><text x=\'96\' y=\'120\' font-size=\'100\' text-anchor=\'middle\' fill=\'white\'>üëë</text></svg>',
            'sizes': '192x192',
            'type': 'image/svg+xml'
        }]
    }">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        /* Navigation */
        .nav-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .nav-header {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 4px;
        }

        .nav-item {
            flex: 1;
        }

        .nav-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 16px;
            text-decoration: none;
            color: rgba(255,255,255,0.8);
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            min-width: 80px;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: translateY(-1px);
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        /* Content */
        .app-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 140px);
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            text-align: center;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: #64748b;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            border: 1px solid #e9ecef;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f1f3f4;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        /* Stats */
        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        /* Charts placeholder */
        .chart-container {
            height: 300px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 1.1rem;
            border: 2px dashed #dee2e6;
        }

        /* Settings */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h4 {
            margin-bottom: 4px;
            color: #2c3e50;
        }

        .setting-info p {
            color: #64748b;
            font-size: 0.9rem;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle.active {
            background: #667eea;
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }

        .toggle.active::after {
            transform: translateX(26px);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            border: 3px solid white;
        }

        /* Goals */
        .goal-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #28a745;
            margin-bottom: 16px;
        }

        .goal-progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-top: 12px;
            overflow: hidden;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* App Menu */
        .app-menu {
            position: absolute;
            top: 70px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            min-width: 200px;
            z-index: 2000;
            border: 1px solid #e9ecef;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        .menu-item:hover {
            background: #f8f9fa;
        }

        .menu-item:first-child {
            border-radius: 12px 12px 0 0;
        }

        .menu-item:last-child {
            border-radius: 0 0 12px 12px;
        }

        .menu-item span:first-child {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        /* Install Button Styles */
        #installButton {
            animation: pulse 2s infinite;
        }

        #installButton:hover {
            background: #218838 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4) !important;
        }

        @keyframes pulse {
            0% { box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); }
            50% { box-shadow: 0 4px 16px rgba(40, 167, 69, 0.5); }
            100% { box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); }
        }

        /* Install Banner */
        .install-banner-main {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 16px 24px;
            margin: 20px auto;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
            max-width: 500px;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .install-banner-main h3 {
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .install-banner-main p {
            margin-bottom: 16px;
            opacity: 0.9;
        }

        .install-banner-main .btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            margin: 0 8px;
            font-weight: 600;
        }

        .install-banner-main .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        @media (max-width: 768px) {
            .app-content {
                padding: 15px;
            }

            .nav-menu {
                flex-wrap: wrap;
            }

            .nav-link {
                min-width: 60px;
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .nav-icon {
                font-size: 1.2rem;
            }

            .page-header {
                padding: 24px 20px;
            }

            .page-title {
                font-size: 2rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="nav-container">
        <div class="nav-header">
            <div class="app-title">
                <span>üëë</span>
                <span>–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è</span>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
                <!-- –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA -->
                <button id="installButton" class="btn" style="background: #28a745; color: white; padding: 10px 16px; font-size: 0.9rem; font-weight: 600; border-radius: 8px; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.3s ease;">
                    üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
                <!-- –ú–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
                <button onclick="toggleAppMenu()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 1.2rem;">
                    ‚ãÆ
                </button>
            </div>
        </div>
        
        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <div id="appMenu" class="app-menu" style="display: none;">
            <div class="menu-item" onclick="showInstallInstructions()">
                <span>üì±</span>
                <span>–ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</span>
            </div>
            <div class="menu-item" onclick="showAppInfo()">
                <span>‚ÑπÔ∏è</span>
                <span>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</span>
            </div>
            <div class="menu-item" onclick="showKeyboardShortcuts()">
                <span>‚å®Ô∏è</span>
                <span>–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</span>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" data-page="dashboard">
                        <span class="nav-icon">üìä</span>
                        <span>–î–∞—à–±–æ—Ä–¥</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#input" class="nav-link" data-page="input">
                        <span class="nav-icon">‚ûï</span>
                        <span>–í–≤–æ–¥</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#analytics" class="nav-link" data-page="analytics">
                        <span class="nav-icon">üìà</span>
                        <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#goals" class="nav-link" data-page="goals">
                        <span class="nav-icon">üéØ</span>
                        <span>–¶–µ–ª–∏</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#settings" class="nav-link" data-page="settings">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <div class="app-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–Ω–Ω–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
            <div id="mainInstallBanner" class="install-banner-main" style="display: none;">
                <h3>üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ!</h3>
                <p>–ü–æ–ª—É—á–∏—Ç–µ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —Å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –æ—Ñ—Ñ–ª–∞–π–Ω</p>
                <button onclick="installFromMainBanner()" class="btn">‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å</button>
                <button onclick="dismissMainBanner()" class="btn">‚ùå –ù–µ —Å–µ–π—á–∞—Å</button>
            </div>

            <div class="page-header">
                <div class="page-title">üìä –û–±–∑–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</div>
                <div class="page-subtitle">–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</div>
            </div>

            <div class="grid-4">
                <div class="stat-item">
                    <div class="stat-value" id="totalDays">42</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –¥–Ω–µ–π</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentStreak">7</div>
                    <div class="stat-label">–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="weeklyProgress">85%</div>
                    <div class="stat-label">–ó–∞ –Ω–µ–¥–µ–ª—é</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="monthlyGoal">12/15</div>
                    <div class="stat-label">–¶–µ–ª—å –º–µ—Å—è—Ü–∞</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</h4>
                            <p>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç—ë–º–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</p>
                        </div>
                        <div class="toggle" onclick="toggleSetting(this)"></div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</h4>
                            <p>–£–º–µ–Ω—å—à–∏—Ç—å –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                        </div>
                        <div class="toggle" onclick="toggleSetting(this)"></div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>–ê–Ω–∏–º–∞—Ü–∏–∏</h4>
                            <p>–í–∫–ª—é—á–∏—Ç—å –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã</p>
                        </div>
                        <div class="toggle active" onclick="toggleSetting(this)"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h4>
                            <p>–ù–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è</p>
                        </div>
                        <div class="toggle active" onclick="toggleSetting(this)"></div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ü–µ–ª—è—Ö</h4>
                            <p>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–º —Ü–µ–ª—è–º</p>
                        </div>
                        <div class="toggle" onclick="toggleSetting(this)"></div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h4>
                            <p>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö</p>
                        </div>
                        <div class="toggle active" onclick="toggleSetting(this)"></div>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üíæ –î–∞–Ω–Ω—ã–µ</div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-primary" onclick="exportCSV()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                        <button class="btn btn-secondary" onclick="exportJSON()">üì• –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è (JSON)</button>
                        <button class="btn btn-success">‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Å–∫–æ—Ä–æ)</button>
                        <button class="btn" style="background: #dc3545; color: white;" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                    </div>

                    <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                        <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h4>
                        <p style="margin: 8px 0; color: #64748b;">–ó–∞–ø–∏—Å–µ–π: 42</p>
                        <p style="margin: 8px 0; color: #64748b;">–†–∞–∑–º–µ—Ä: 156 KB</p>
                        <p style="margin: 8px 0; color: #64748b;">–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéØ –¶–µ–ª–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å (–¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é)</label>
                        <select class="form-input">
                            <option>5 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é</option>
                            <option>6 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é</option>
                            <option selected>7 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                        <input type="time" class="form-input" value="21:00">
                    </div>

                    <div class="form-group">
                        <label class="form-label">–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞</label>
                        <select class="form-input">
                            <option>CSV (Excel)</option>
                            <option>JSON</option>
                            <option>PDF –æ—Ç—á—ë—Ç</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
                </div>
                
                <div class="grid-3">
                    <div>
                        <h4>–í–µ—Ä—Å–∏—è</h4>
                        <p style="color: #64748b;">2.0.0</p>
                    </div>
                    <div>
                        <h4>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</h4>
                        <p style="color: #64748b;">26 –∏—é–Ω—è 2025</p>
                    </div>
                    <div>
                        <h4>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</h4>
                        <p style="color: #64748b;">–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å</p>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 8px;">
                    <h4>üéâ –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≤–µ—Ä—Å–∏–∏ 2.0</h4>
                    <ul style="margin-top: 12px; padding-left: 20px;">
                        <li>–°–∏—Å—Ç–µ–º–∞ —Ü–µ–ª–µ–π –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</li>
                        <li>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</li>
                        <li>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö</li>
                        <li>–£–ª—É—á—à–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</li>
                        <li>–û—Ñ—Ñ–ª–∞–π–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üóÑÔ∏è –£–õ–£–ß–®–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• (IndexedDB)
        class DataManager {
            constructor() {
                this.dbName = 'ControlSystemDB';
                this.dbVersion = 1;
                this.db = null;
                this.fallbackToLocalStorage = false;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IndexedDB
            async init() {
                try {
                    return new Promise((resolve, reject) => {
                        const request = indexedDB.open(this.dbName, this.dbVersion);
                        
                        request.onerror = () => {
                            console.log('IndexedDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
                            this.fallbackToLocalStorage = true;
                            resolve(null);
                        };
                        
                        request.onsuccess = () => {
                            this.db = request.result;
                            console.log('‚úÖ IndexedDB –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                            resolve(this.db);
                        };
                        
                        request.onupgradeneeded = (event) => {
                            const db = event.target.result;
                            
                            // –°–æ–∑–¥–∞—ë–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∑–∞–ø–∏—Å–µ–π
                            if (!db.objectStoreNames.contains('records')) {
                                const store = db.createObjectStore('records', { keyPath: 'id', autoIncrement: true });
                                store.createIndex('date', 'date', { unique: false });
                                store.createIndex('timestamp', 'timestamp', { unique: false });
                            }
                            
                            // –°–æ–∑–¥–∞—ë–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
                            if (!db.objectStoreNames.contains('settings')) {
                                db.createObjectStore('settings', { keyPath: 'key' });
                            }
                        };
                    });
                } catch (error) {
                    console.log('–û—à–∏–±–∫–∞ IndexedDB, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
                    this.fallbackToLocalStorage = true;
                    return null;
                }
            }

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            async addRecord(record) {
                const recordWithMeta = {
                    ...record,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    date: record.date || new Date().toISOString().split('T')[0]
                };

                if (this.fallbackToLocalStorage || !this.db) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º localStorage –∫–∞–∫ fallback
                    const records = this.getLocalStorageRecords();
                    records.unshift(recordWithMeta);
                    localStorage.setItem('progressRecords', JSON.stringify(records));
                    return recordWithMeta;
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º IndexedDB
                    const transaction = this.db.transaction(['records'], 'readwrite');
                    const store = transaction.objectStore('records');
                    
                    return new Promise((resolve, reject) => {
                        const request = store.add(recordWithMeta);
                        request.onsuccess = () => resolve(recordWithMeta);
                        request.onerror = () => reject(request.error);
                    });
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
            async getAllRecords() {
                if (this.fallbackToLocalStorage || !this.db) {
                    return this.getLocalStorageRecords();
                } else {
                    const transaction = this.db.transaction(['records'], 'readonly');
                    const store = transaction.objectStore('records');
                    
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => {
                            const records = request.result.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                            resolve(records);
                        };
                        request.onerror = () => reject(request.error);
                    });
                }
            }

            // Fallback –∫ localStorage
            getLocalStorageRecords() {
                const stored = localStorage.getItem('progressRecords');
                return stored ? JSON.parse(stored) : [];
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            async getStats() {
                const records = await this.getAllRecords();
                return {
                    total: records.length,
                    thisWeek: this.getWeekRecords(records).length,
                    streak: this.calculateStreak(records),
                    lastUpdate: records[0]?.timestamp || null
                };
            }

            // –ó–∞–ø–∏—Å–∏ –∑–∞ –Ω–µ–¥–µ–ª—é
            getWeekRecords(records) {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                return records.filter(record => new Date(record.timestamp) >= oneWeekAgo);
            }

            // –†–∞—Å—á—ë—Ç —Å–µ—Ä–∏–∏
            calculateStreak(records) {
                if (!records.length) return 0;
                
                let streak = 0;
                const today = new Date();
                
                for (let i = 0; i < 365; i++) {
                    const checkDate = new Date(today);
                    checkDate.setDate(today.getDate() - i);
                    const dateString = checkDate.toISOString().split('T')[0];
                    
                    if (records.some(record => record.date === dateString)) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                return streak;
            }

            // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV
            async exportToCSV() {
                const records = await this.getAllRecords();
                
                const headers = ['–î–∞—Ç–∞', '–†–∞–±–æ—Ç–∞', '–°—Ç—Ä—É–∫—Ç—É—Ä–∞', '–§–æ—Ä–º–∞', '–°–æ—Å—Ç–æ—è–Ω–∏–µ', '–ó–∞–º–µ—Ç–∫–∏'];
                const csvContent = [
                    headers.join(','),
                    ...records.map(record => [
                        record.date,
                        `"${(record.work || '').replace(/"/g, '""')}"`,
                        `"${(record.structure || '').replace(/"/g, '""')}"`,
                        `"${(record.form || '').replace(/"/g, '""')}"`,
                        `"${(record.state || '').replace(/"/g, '""')}"`,
                        `"${(record.notes || '').replace(/"/g, '""')}"`
                    ].join(','))
                ].join('\n');
                
                this.downloadFile(csvContent, 'control-system-data.csv', 'text/csv');
            }

            // –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
            async exportToJSON() {
                const records = await this.getAllRecords();
                const stats = await this.getStats();
                
                const exportData = {
                    exportDate: new Date().toISOString(),
                    stats: stats,
                    records: records,
                    version: '2.0'
                };
                
                const jsonContent = JSON.stringify(exportData, null, 2);
                this.downloadFile(jsonContent, 'control-system-backup.json', 'application/json');
            }

            // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
            }

            // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
            async clearAllData() {
                if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                    if (this.fallbackToLocalStorage || !this.db) {
                        localStorage.removeItem('progressRecords');
                    } else {
                        const transaction = this.db.transaction(['records'], 'readwrite');
                        const store = transaction.objectStore('records');
                        store.clear();
                    }
                    
                    // –û—á–∏—â–∞–µ–º —Ç–∞–∫–∂–µ localStorage –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
                    localStorage.clear();
                    
                    alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
                    location.reload();
                }
            }
        }

        // üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
        let dataManager;

        // Navigation
        function switchPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageName).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageName}"]`).classList.add('active');
        }

        // Navigation event listeners
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageName = link.getAttribute('data-page');
                switchPage(pageName);
                
                // Update URL without page reload
                history.pushState({page: pageName}, '', `#${pageName}`);
            });
        });

        // Handle browser back/forward
        window.addEventListener('popstate', (e) => {
            const page = e.state?.page || 'dashboard';
            switchPage(page);
        });

        // Initialize page from URL
        document.addEventListener('DOMContentLoaded', async () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            dataManager = new DataManager();
            await dataManager.init();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            await updateDashboardStats();
            await loadRecentRecords();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const hash = window.location.hash.slice(1);
            const page = hash || 'dashboard';
            switchPage(page);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è
            showStorageStatus();
        });

        // Settings toggles
        function toggleSetting(toggle) {
            toggle.classList.toggle('active');
            
            // Here you can add logic to save settings
            const isActive = toggle.classList.contains('active');
            const settingName = toggle.parentElement.querySelector('h4').textContent;
            
            console.log(`Setting "${settingName}" is now ${isActive ? 'enabled' : 'disabled'}`);
            
            // Save to localStorage
            localStorage.setItem(`setting_${settingName}`, isActive);
        }

        // Form submission —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
        document.getElementById('progressForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(e.target);
            const inputs = e.target.querySelectorAll('.form-input');
            
            const record = {
                work: inputs[0].value.trim(),
                structure: inputs[1].value.trim(),
                form: inputs[2].value.trim(),
                state: inputs[3].value.trim(),
                notes: inputs[4]?.value.trim() || ''
            };

            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ —É–ª—É—á—à–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
                await dataManager.addRecord(record);
                
                // Show success message
                const btn = e.target.querySelector('.add-btn');
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
                
                // Reset form
                e.target.reset();
                
                // Clear autosaved drafts
                ['workInput', 'structureInput', 'formInput', 'stateInput'].forEach(inputId => {
                    localStorage.removeItem(`autosave_${inputId}`);
                });
                
                // Update dashboard
                await updateDashboardStats();
                await loadRecentRecords();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏');
            }
        });

        // Update dashboard statistics
        async function updateDashboardStats() {
            try {
                const stats = await dataManager.getStats();
                
                document.getElementById('totalDays').textContent = stats.total;
                document.getElementById('currentStreak').textContent = stats.streak;
                document.getElementById('weeklyProgress').textContent = Math.round((stats.thisWeek / 7) * 100) + '%';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–ª—å –º–µ—Å—è—Ü–∞ (–ø—Ä–∏–º–µ—Ä)
                const monthlyGoal = 25; // —Ü–µ–ª—å –Ω–∞ –º–µ—Å—è—Ü
                const monthProgress = Math.min(stats.total, monthlyGoal);
                document.getElementById('monthlyGoal').textContent = `${monthProgress}/${monthlyGoal}`;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
        async function loadRecentRecords() {
            try {
                const records = await dataManager.getAllRecords();
                const recentRecords = records.slice(0, 5); // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π
                
                const timelineContainer = document.querySelector('.timeline');
                if (timelineContainer && recentRecords.length > 0) {
                    timelineContainer.innerHTML = recentRecords.map((record, index) => {
                        const date = new Date(record.date);
                        const dateLabel = index === 0 ? '–°–µ–≥–æ–¥–Ω—è' : 
                                         index === 1 ? '–í—á–µ—Ä–∞' : 
                                         date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                        
                        const stateClass = getStateClass(record.state);
                        
                        return `
                            <div class="timeline-item">
                                <strong>${dateLabel}</strong>
                                <p>–†–∞–±–æ—Ç–∞: ${record.work}<br>
                                –°—Ç—Ä—É–∫—Ç—É—Ä–∞: ${record.structure}<br>
                                –§–æ—Ä–º–∞: ${record.form}</p>
                                <small class="${stateClass}">–°–æ—Å—Ç–æ—è–Ω–∏–µ: ${record.state}</small>
                            </div>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π:', error);
            }
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function getStateClass(state) {
            const positive = ['–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ', '–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', '—ç–Ω–µ—Ä–≥–∏—á–Ω–æ', '–∫–æ–Ω—Ç—Ä–æ–ª—å', '—à–∞–≥ –≤–ø–µ—Ä—ë–¥', '–±–æ–¥—Ä–æ', '–≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ', '—è—Å–Ω–æ—Å—Ç—å'];
            const negative = ['—É—Å—Ç–∞–ª–æ—Å—Ç—å', '–±–æ—Ä—å–±–∞', '–ª–µ–Ω—å', '—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ', '–Ω–∏–∂–µ –ø–ª–∏–Ω—Ç—É—Å–∞'];
            
            const lowerState = state.toLowerCase();
            if (positive.some(word => lowerState.includes(word))) return 'state-positive';
            if (negative.some(word => lowerState.includes(word))) return 'state-negative';
            return 'state-neutral';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è
        function showStorageStatus() {
            const statusElement = document.createElement('div');
            statusElement.style.cssText = `
                position: fixed;
                bottom: 80px;
                right: 20px;
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 0.8rem;
                z-index: 1000;
            `;
            
            statusElement.textContent = dataManager.fallbackToLocalStorage ? 
                'üíæ localStorage' : 'üóÑÔ∏è IndexedDB';
            
            document.body.appendChild(statusElement);
            
            setTimeout(() => {
                statusElement.remove();
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        window.exportCSV = async () => {
            try {
                await dataManager.exportToCSV();
                alert('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV');
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message);
            }
        };

        window.exportJSON = async () => {
            try {
                await dataManager.exportToJSON();
                alert('‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞');
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ø–∏–∏: ' + error.message);
            }
        };

        window.clearAllData = async () => {
            await dataManager.clearAllData();
        };

        // PWA installation with prominent install button
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const mainInstallBanner = document.getElementById('mainInstallBanner');
        
        // Create proper manifest
        const manifest = {
            name: '–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–ª—è –ü–æ–≤–µ–ª–∏—Ç–µ–ª—è',
            short_name: '–ö–æ–Ω—Ç—Ä–æ–ª—å',
            description: '–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω—å—é',
            start_url: window.location.pathname,
            display: 'standalone',
            background_color: '#ffffff',
            theme_color: '#667eea',
            orientation: 'portrait',
            icons: [
                {
                    src: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxOTIgMTkyIj48cmVjdCB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgZmlsbD0iIzY2N2VlYSIvPjx0ZXh0IHg9Ijk2IiB5PSIxMjAiIGZvbnQtc2l6ZT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSI+8J+RkTwvdGV4dD48L3N2Zz4=',
                    sizes: '192x192',
                    type: 'image/svg+xml'
                },
                {
                    src: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iIzY2N2VlYSIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LXNpemU9IjI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPvCfkZE8L3RleHQ+PC9zdmc+',
                    sizes: '512x512',
                    type: 'image/svg+xml'
                }
            ]
        };
        
        // Create manifest blob and URL
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestURL;
        
        // Show install button immediately (always visible)
        installButton.style.display = 'block';
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show main banner if not dismissed
            if (!localStorage.getItem('mainBannerDismissed')) {
                mainInstallBanner.style.display = 'block';
            }
            
            // Also show floating banner
            showInstallBanner();
        });
        
        // Install button click (always works)
        installButton.addEventListener('click', () => {
            attemptInstall();
        });
        
        function attemptInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((result) => {
                    if (result.outcome === 'accepted') {
                        console.log('PWA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                        hideInstallElements();
                    }
                    deferredPrompt = null;
                });
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –µ—Å–ª–∏ –Ω–µ—Ç beforeinstallprompt
                showManualInstallInstructions();
            }
        }
        
        function hideInstallElements() {
            installButton.style.display = 'none';
            mainInstallBanner.style.display = 'none';
            document.getElementById('installBanner')?.remove();
        }
        
        function showInstallBanner() {
            // Remove existing banner if any
            const existingBanner = document.getElementById('installBanner');
            if (existingBanner) existingBanner.remove();
            
            const banner = document.createElement('div');
            banner.id = 'installBanner';
            banner.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 16px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; z-index: 2000; box-shadow: 0 4px 20px rgba(40, 167, 69, 0.4); animation: slideUp 0.3s ease;">
                    <div>
                        <strong>üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</strong>
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 4px;">–†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="installFromBanner()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button onclick="dismissInstallBanner()" style="background: rgba(255,255,255,0.1); border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer;">‚úï</button>
                    </div>
                </div>
                <style>
                    @keyframes slideUp {
                        from { transform: translateY(100px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(banner);
        }
        
        function showManualInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent);
            const isSafari = /Safari/.test(navigator.userAgent) && !isChrome;
            
            let instructions = '';
            if (isIOS && isSafari) {
                instructions = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3rem;">üì±</div>
                        <h3 style="color: #2c3e50; margin: 16px 0;">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ iPhone/iPad</h3>
                    </div>
                    <div style="text-align: left; line-height: 1.8; color: #64748b;">
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #007AFF; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">1</span>
                            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"</strong> –≤–Ω–∏–∑—É Safari
                        </div>
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #007AFF; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">2</span>
                            –í—ã–±–µ—Ä–∏—Ç–µ <strong>"–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π"</strong>
                        </div>
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #007AFF; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">3</span>
                            –ù–∞–∂–º–∏—Ç–µ <strong>"–î–æ–±–∞–≤–∏—Ç—å"</strong>
                        </div>
                    </div>
                `;
            } else if (isAndroid && isChrome) {
                instructions = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3rem;">üì±</div>
                        <h3 style="color: #2c3e50; margin: 16px 0;">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Android</h3>
                    </div>
                    <div style="text-align: left; line-height: 1.8; color: #64748b;">
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #4285F4; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">1</span>
                            –ù–∞–∂–º–∏—Ç–µ –º–µ–Ω—é <strong>‚ãÆ</strong> –≤ Chrome
                        </div>
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #4285F4; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">2</span>
                            –í—ã–±–µ—Ä–∏—Ç–µ <strong>"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"</strong>
                        </div>
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #4285F4; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">3</span>
                            –ù–∞–∂–º–∏—Ç–µ <strong>"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"</strong>
                        </div>
                    </div>
                `;
            } else {
                instructions = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3rem;">üíª</div>
                        <h3 style="color: #2c3e50; margin: 16px 0;">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä</h3>
                    </div>
                    <div style="text-align: left; line-height: 1.8; color: #64748b;">
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #667eea; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">1</span>
                            –ù–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–æ–∫ <strong>‚¨áÔ∏è</strong> –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
                        </div>
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #667eea; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">2</span>
                            –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞
                        </div>
                        <div style="display: flex; align-items: center; margin: 12px 0;">
                            <span style="background: #667eea; color: white; border-radius: 4px; padding: 4px 8px; margin-right: 12px; font-size: 0.8rem;">3</span>
                            –í—ã–±–µ—Ä–∏—Ç–µ <strong>"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"</strong>
                        </div>
                    </div>
                `;
            }
            
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px; animation: fadeIn 0.3s ease;">
                    <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 100%; animation: slideIn 0.3s ease;">
                        ${instructions}
                        <div style="text-align: center; margin-top: 24px;">
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="background: #28a745; color: white; border: none; padding: 12px 32px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem;">–ü–æ–Ω—è—Ç–Ω–æ</button>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                    @keyframes slideIn { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
                </style>
            `;
            document.body.appendChild(modal);
        }
        
        // App menu functions
        window.toggleAppMenu = () => {
            const menu = document.getElementById('appMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        };
        
        window.showInstallInstructions = () => {
            document.getElementById('appMenu').style.display = 'none';
            showManualInstallInstructions();
        };
        
        window.showAppInfo = () => {
            document.getElementById('appMenu').style.display = 'none';
            switchPage('settings');
        };
        
        window.showKeyboardShortcuts = () => {
            document.getElementById('appMenu').style.display = 'none';
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px;">
                    <div style="background: white; border-radius: 16px; padding: 32px; max-width: 400px;">
                        <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h3>
                        <div style="line-height: 1.8; color: #64748b;">
                            <div><strong>Ctrl/Cmd + 1-5</strong> - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü</div>
                            <div><strong>Ctrl/Cmd + Enter</strong> - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</div>
                            <div><strong>Esc</strong> - –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞</div>
                        </div>
                        <div style="text-align: center; margin-top: 24px;">
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };
        
        // Main banner functions
        window.installFromMainBanner = () => {
            attemptInstall();
        };
        
        window.dismissMainBanner = () => {
            mainInstallBanner.style.display = 'none';
            localStorage.setItem('mainBannerDismissed', 'true');
        };
        
        // Floating banner functions
        window.installFromBanner = () => {
            attemptInstall();
        };
        
        window.dismissInstallBanner = () => {
            document.getElementById('installBanner')?.remove();
            localStorage.setItem('installBannerDismissed', 'true');
        };
        
        // Check if already installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            hideInstallElements();
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 16px 24px; border-radius: 12px; z-index: 2000; animation: slideDown 0.3s ease; box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">‚úÖ</span>
                        <div>
                            <strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!</strong>
                            <div style="font-size: 0.9rem; opacity: 0.9;">–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ —Å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞</div>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes slideDown {
                        from { transform: translateY(-50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(successMessage);
            
            setTimeout(() => {
                successMessage.remove();
            }, 5000);
        });
        
        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // Close any open modals
                document.querySelectorAll('[style*="position: fixed"][style*="z-index: 3000"]').forEach(modal => {
                    modal.remove();
                });
                // Close app menu
                document.getElementById('appMenu').style.display = 'none';
            }
        });%); color: white; padding: 16px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; z-index: 2000; box-shadow: 0 4px 20px rgba(0,0,0,0.3); animation: slideUp 0.3s ease;">
                    <div>
                        <strong>üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</strong>
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 4px;">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —Å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="installFromBanner()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button onclick="dismissInstallBanner()" style="background: rgba(255,255,255,0.1); border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer;">‚úï</button>
                    </div>
                </div>
                <style>
                    @keyframes slideUp {
                        from { transform: translateY(100px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(banner);
        }
        
        function showManualInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            if (isIOS) {
                instructions = `
                    <strong>üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ iPhone/iPad:</strong><br>
                    1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –≤ Safari<br>
                    2. –í—ã–±–µ—Ä–∏—Ç–µ "–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π"<br>
                    3. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å"
                `;
            } else if (isAndroid) {
                instructions = `
                    <strong>üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Android:</strong><br>
                    1. –ù–∞–∂–º–∏—Ç–µ –º–µ–Ω—é (‚ãÆ) –≤ Chrome<br>
                    2. –í—ã–±–µ—Ä–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"<br>
                    3. –ù–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"
                `;
            } else {
                instructions = `
                    <strong>üíª –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä:</strong><br>
                    1. –ù–∞–∂–º–∏—Ç–µ –∑–Ω–∞—á–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ<br>
                    2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞<br>
                    3. –í—ã–±–µ—Ä–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
                `;
            }
            
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px;">
                    <div style="background: white; border-radius: 16px; padding: 32px; max-width: 400px; text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">üì±</div>
                        <h3 style="margin-bottom: 20px; color: #2c3e50;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
                        <div style="text-align: left; margin-bottom: 24px; line-height: 1.6; color: #64748b;">
                            ${instructions}
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">–ü–æ–Ω—è—Ç–Ω–æ</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Global functions for banner buttons
        window.installFromBanner = () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((result) => {
                    document.getElementById('installBanner')?.remove();
                    if (result.outcome === 'accepted') {
                        installButton.style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            } else {
                showManualInstallInstructions();
            }
        };
        
        window.dismissInstallBanner = () => {
            document.getElementById('installBanner')?.remove();
            // Remember user dismissed (optional)
            localStorage.setItem('installBannerDismissed', 'true');
        };
        
        // Check if already installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            installButton.style.display = 'none';
            document.getElementById('installBanner')?.remove();
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 12px 20px; border-radius: 8px; z-index: 2000; animation: slideDown 0.3s ease;">
                    ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
                </div>
                <style>
                    @keyframes slideDown {
                        from { transform: translateY(-50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(successMessage);
            
            setTimeout(() => {
                successMessage.remove();
            }, 3000);
        });

        // Enhanced Service Worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'control-system-v2.0';
                    const urlsToCache = [
                        '/',
                        'data:text/css,', // Fallback for offline CSS
                        'data:text/javascript,' // Fallback for offline JS
                    ];

                    // Install event
                    self.addEventListener('install', event => {
                        console.log('Service Worker installing...');
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    console.log('Cache opened');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                        self.skipWaiting(); // Force activation of new SW
                    });

                    // Activate event
                    self.addEventListener('activate', event => {
                        console.log('Service Worker activating...');
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== CACHE_NAME) {
                                            console.log('Deleting old cache:', cacheName);
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                        self.clients.claim(); // Take control of all pages
                    });

                    // Fetch event - Cache First strategy
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    // Return cached version or fetch from network
                                    if (response) {
                                        return response;
                                    }
                                    
                                    return fetch(event.request)
                                        .then(response => {
                                            // Check if valid response
                                            if (!response || response.status !== 200 || response.type !== 'basic') {
                                                return response;
                                            }
                                            
                                            // Clone response for cache
                                            const responseToCache = response.clone();
                                            
                                            caches.open(CACHE_NAME)
                                                .then(cache => {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            
                                            return response;
                                        })
                                        .catch(() => {
                                            // Return offline fallback if available
                                            return caches.match('/');
                                        });
                                })
                        );
                    });

                    // Background sync for data
                    self.addEventListener('sync', event => {
                        if (event.tag === 'background-sync') {
                            event.waitUntil(
                                // Sync data when back online
                                console.log('Background sync triggered')
                            );
                        }
                    });
                `;
                
                navigator.serviceWorker.register(
                    'data:text/javascript;base64,' + btoa(swCode)
                ).then(registration => {
                    console.log('‚úÖ Service Worker registered successfully');
                    
                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // New version available
                                    showUpdateAvailable();
                                }
                            }
                        });
                    });
                    
                }).catch(error => {
                    console.log('‚ùå Service Worker registration failed:', error);
                });
                
                // Listen for SW messages
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data && event.data.type === 'SKIP_WAITING') {
                        window.location.reload();
                    }
                });
            });
        }
        
        function showUpdateAvailable() {
            const updateNotification = document.createElement('div');
            updateNotification.innerHTML = `
                <div style="position: fixed; top: 20px; left: 20px; right: 20px; background: #667eea; color: white; padding: 16px; border-radius: 12px; z-index: 2000; box-shadow: 0 4px 20px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>üÜï –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</strong>
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 4px;">–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥–æ—Ç–æ–≤–∞</div>
                    </div>
                    <button onclick="updateApp()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            `;
            document.body.appendChild(updateNotification);
        }
        
        window.updateApp = () => {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({type: 'SKIP_WAITING'});
            }
        };

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboardStats();
            
            // Load saved settings
            document.querySelectorAll('.toggle').forEach(toggle => {
                const settingName = toggle.parentElement.querySelector('h4').textContent;
                const saved = localStorage.getItem(`setting_${settingName}`);
                if (saved === 'true') {
                    toggle.classList.add('active');
                }
            });
        });

        // Auto-save functionality
        const autoSaveInputs = document.querySelectorAll('.form-input');
        autoSaveInputs.forEach(input => {
            input.addEventListener('input', () => {
                localStorage.setItem(`autosave_${input.name || input.placeholder}`, input.value);
            });
            
            // Restore autosaved data
            const saved = localStorage.getItem(`autosave_${input.name || input.placeholder}`);
            if (saved) {
                input.value = saved;
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Number for quick navigation
            if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '5') {
                e.preventDefault();
                const pages = ['dashboard', 'input', 'analytics', 'goals', 'settings'];
                switchPage(pages[parseInt(e.key) - 1]);
            }
            
            // Ctrl/Cmd + Enter to submit form
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                const form = document.querySelector('#progressForm');
                if (form && document.getElementById('input').classList.contains('active')) {
                    form.dispatchEvent(new Event('submit'));
                }
            }
        });

        // Notifications (if supported)
        if ('Notification' in window) {
            // Request permission
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Daily reminder (example)
            function checkDailyReminder() {
                const now = new Date();
                const reminderTime = localStorage.getItem('reminderTime') || '21:00';
                const [hours, minutes] = reminderTime.split(':');
                
                if (now.getHours() == hours && now.getMinutes() == minutes) {
                    if (Notification.permission === 'granted') {
                        new Notification('üëë –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏!', {
                            body: '–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ —Å–µ–≥–æ–¥–Ω—è',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" fill="%23667eea"/><text x="32" y="45" font-size="35" text-anchor="middle" fill="white">üëë</text></svg>'
                        });
                    }
                }
            }
            
            // Check every minute
            setInterval(checkDailyReminder, 60000);
        }
    </script>
</body>
</html>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üî• –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</div>
                    </div>
                    <div class="chart-container">
                        üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                        <br><small>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">‚ö° –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-item">
                            <strong>–°–µ–≥–æ–¥–Ω—è</strong>
                            <p>–†–∞–±–æ—Ç–∞: –û–±–Ω–æ–≤–∏–ª —Ä–µ–∑—é–º–µ<br>
                            –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –£–±—Ä–∞–ª –≤ –∫–æ–º–Ω–∞—Ç–µ<br>
                            –§–æ—Ä–º–∞: –ü—Ä–æ–±–µ–∂–∫–∞ 5–∫–º</p>
                            <small style="color: #28a745;">–°–æ—Å—Ç–æ—è–Ω–∏–µ: –≠–Ω–µ—Ä–≥–∏—á–Ω–æ</small>
                        </div>
                        <div class="timeline-item">
                            <strong>–í—á–µ—Ä–∞</strong>
                            <p>–†–∞–±–æ—Ç–∞: –û—Ç–∫–ª–∏–∫–Ω—É–ª—Å—è –Ω–∞ 3 –≤–∞–∫–∞–Ω—Å–∏–∏<br>
                            –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –û–ø–ª–∞—Ç–∏–ª —Å—á–µ—Ç–∞<br>
                            –§–æ—Ä–º–∞: –ó–∞—Ä—è–¥–∫–∞ —É—Ç—Ä–æ–º</p>
                            <small style="color: #667eea;">–°–æ—Å—Ç–æ—è–Ω–∏–µ: –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Page -->
        <div id="input" class="page">
            <div class="page-header">
                <div class="page-title">‚ûï –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</div>
                <div class="page-subtitle">–ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
            </div>

            <div class="card">
                <form id="progressForm">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">üíº –†–∞–±–æ—Ç–∞</label>
                            <input type="text" class="form-input" placeholder="–ß—Ç–æ —Å–¥–µ–ª–∞–ª –ø–æ —Ä–∞–±–æ—Ç–µ?" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞</label>
                            <input type="text" class="form-input" placeholder="–ö–∞–∫ –Ω–∞–≤—ë–ª –ø–æ—Ä—è–¥–æ–∫?" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üí™ –§–æ—Ä–º–∞</label>
                            <input type="text" class="form-input" placeholder="–ö–∞–∫ –∑–∞–±–æ—Ç–∏–ª—Å—è –æ –∑–¥–æ—Ä–æ–≤—å–µ?" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üß† –°–æ—Å—Ç–æ—è–Ω–∏–µ</label>
                            <input type="text" class="form-input" placeholder="–ú–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</label>
                        <textarea class="form-input" rows="3" placeholder="–û—Å–æ–±—ã–µ —Å–æ–±—ã—Ç–∏—è, –º—ã—Å–ª–∏, –ø–ª–∞–Ω—ã..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">üí° –ò–¥–µ–∏ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="grid-3">
                    <div style="padding: 16px; background: #fff5f5; border-radius: 8px; border-left: 4px solid #ff6b6b;">
                        <strong>üíº –†–∞–±–æ—Ç–∞</strong>
                        <p style="margin-top: 8px; color: #64748b;">–û–±–Ω–æ–≤–∏—Ç—å LinkedIn –ø—Ä–æ—Ñ–∏–ª—å</p>
                    </div>
                    <div style="padding: 16px; background: #f0fdfc; border-radius: 8px; border-left: 4px solid #4ecdc4;">
                        <strong>üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞</strong>
                        <p style="margin-top: 8px; color: #64748b;">–†–∞–∑–æ–±—Ä–∞—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É</p>
                    </div>
                    <div style="padding: 16px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #45b7d1;">
                        <strong>üí™ –§–æ—Ä–º–∞</strong>
                        <p style="margin-top: 8px; color: #64748b;">–ü—Ä–æ–≥—É–ª–∫–∞ 30 –º–∏–Ω—É—Ç</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics" class="page">
            <div class="page-header">
                <div class="page-title">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
                <div class="page-subtitle">–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º</div>
                    </div>
                    <div class="chart-container">
                        üéØ –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
                        <br><small>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                    </div>
                    <div class="chart-container">
                        üìÖ –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
                        <br><small>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</small>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                </div>
                <div class="grid-3">
                    <div>
                        <h4>üíº –†–∞–±–æ—Ç–∞</h4>
                        <p>–°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</p>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>–û—Ç–∫–ª–∏–∫–∏ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ (15)</li>
                            <li>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—é–º–µ (8)</li>
                            <li>–ò–∑—É—á–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ (12)</li>
                        </ul>
                    </div>
                    <div>
                        <h4>üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞</h4>
                        <p>–°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</p>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>–£–±–æ—Ä–∫–∞ –¥–æ–º–∞ (20)</li>
                            <li>–§–∏–Ω–∞–Ω—Å—ã (10)</li>
                            <li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (15)</li>
                        </ul>
                    </div>
                    <div>
                        <h4>üí™ –§–æ—Ä–º–∞</h4>
                        <p>–°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</p>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>–ó–∞—Ä—è–¥–∫–∞ (25)</li>
                            <li>–ü—Ä–æ–≥—É–ª–∫–∏ (18)</li>
                            <li>–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ (22)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Page -->
        <div id="goals" class="page">
            <div class="page-header">
                <div class="page-title">üéØ –¶–µ–ª–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                <div class="page-subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö —Ü–µ–ª–µ–π</div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üöÄ –ê–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏</div>
                        <button class="btn btn-primary">+ –ù–æ–≤–∞—è —Ü–µ–ª—å</button>
                    </div>
                    
                    <div class="goal-item">
                        <h4>–ù–∞–π—Ç–∏ –Ω–æ–≤—É—é —Ä–∞–±–æ—Ç—É</h4>
                        <p style="color: #64748b; margin: 8px 0;">–î–æ 15 –∞–≤–≥—É—Å—Ç–∞</p>
                        <div class="goal-progress">
                            <div class="goal-progress-fill" style="width: 65%"></div>
                        </div>
                        <small style="color: #28a745;">65% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</small>
                    </div>

                    <div class="goal-item">
                        <h4>–ü—Ä–æ–±–µ–∂–∞—Ç—å –º–∞—Ä–∞—Ñ–æ–Ω</h4>
                        <p style="color: #64748b; margin: 8px 0;">–î–æ 1 –æ–∫—Ç—è–±—Ä—è</p>
                        <div class="goal-progress">
                            <div class="goal-progress-fill" style="width: 30%"></div>
                        </div>
                        <small style="color: #f39c12;">30% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</small>
                    </div>

                    <div class="goal-item">
                        <h4>–°—ç–∫–æ–Ω–æ–º–∏—Ç—å 100,000‚ÇΩ</h4>
                        <p style="color: #64748b; margin: 8px 0;">–î–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞</p>
                        <div class="goal-progress">
                            <div class="goal-progress-fill" style="width: 45%"></div>
                        </div>
                        <small style="color: #f39c12;">45% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                        <div style="background: #28a745; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">
                            üî• 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
                        </div>
                        <div style="background: #667eea; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">
                            üí™ 30 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                        </div>
                        <div style="background: #f39c12; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">
                            üìö 10 –∫—É—Ä—Å–æ–≤
                        </div>
                        <div style="background: #e74c3c; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">
                            üéØ 50 –∑–∞–ø–∏—Å–µ–π
                        </div>
                    </div>

                    <div style="margin-top: 24px;">
                        <h4>üéñÔ∏è –°–ª–µ–¥—É—é—â–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h4>
                        <div style="margin-top: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0;">
                                <span>üî• 14 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</span>
                                <span style="color: #64748b;">7/14</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0;">
                                <span>üí™ 50 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</span>
                                <span style="color: #64748b;">30/50</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0;">
                                <span>üéØ 100 –∑–∞–ø–∏—Å–µ–π</span>
                                <span style="color: #64748b;">50/100</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="page-header">
                <div class="page-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <div class="page-subtitle">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –æ–ø—ã—Ç–∞</div>
            </div>

            <div class="grid-2">
